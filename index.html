<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PunkMe - Find Your CryptoPunk Match</title>
    <script src="https://unpkg.com/@farcaster/frame-sdk"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
            color: #e6e6e6;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            width: 100%;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(90deg, #00d9ff, #00ffaa, #ff00aa);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 30px;
            padding: 15px;
            background: rgba(30, 30, 46, 0.7);
            border-radius: 15px;
            justify-content: center;
        }
        
        .avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: 2px solid #00d9ff;
        }
        
        .user-details h3 {
            color: #00ffaa;
            margin-bottom: 5px;
        }
        
        .matches-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .punk-card {
            background: rgba(30, 30, 46, 0.7);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            transition: transform 0.3s;
            border: 2px solid transparent;
        }
        
        .punk-card:hover {
            transform: translateY(-5px);
            border-color: #00d9ff;
        }
        
        .punk-image {
            width: 200px;
            height: 200px;
            image-rendering: pixelated;
            margin: 0 auto 15px;
            display: block;
            background: #1a1a2e;
            border-radius: 10px;
        }
        
        .punk-name {
            color: #00ffaa;
            font-size: 1.2rem;
            margin-bottom: 10px;
        }
        
        .similarity-score {
            font-size: 1.3rem;
            font-weight: bold;
            margin: 10px 0;
            color: #ff00aa;
        }
        
        .attributes {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 8px;
            margin-top: 10px;
        }
        
        .attribute {
            background: rgba(0, 217, 255, 0.2);
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
        }
        
        .loading {
            text-align: center;
            margin: 50px 0;
        }
        
        .spinner {
            border: 5px solid rgba(0, 217, 255, 0.3);
            border-radius: 50%;
            border-top: 5px solid #00d9ff;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .controls {
            text-align: center;
            margin: 30px 0;
        }
        
        .btn {
            background: linear-gradient(135deg, #00d9ff 0%, #00ffaa 100%);
            border: none;
            border-radius: 50px;
            color: #1a1a2e;
            padding: 12px 25px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn:hover {
            transform: translateY(-3px);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>PunkMe</h1>
            <p>Find your CryptoPunk matches</p>
        </header>
        
        <div class="user-info" id="user-info">
            <img class="avatar" id="user-avatar" src="" alt="Your avatar">
            <div class="user-details">
                <h3 id="username">Loading...</h3>
                <p>Finding your CryptoPunk matches...</p>
            </div>
        </div>
        
        <div class="controls">
            <button class="btn" id="refresh-btn">Find New Matches</button>
        </div>
        
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>Loading 100 CryptoPunks...</p>
        </div>
        
        <div class="matches-grid" id="matches-grid" style="display: none;"></div>
    </div>

    <script>
        // Initialize Farcaster SDK immediately
        async function initializeFarcaster() {
            try {
                if (typeof frameSdk !== 'undefined') {
                    const sdk = await frameSdk;
                    console.log('Farcaster SDK loaded');
                    await sdk.actions.ready();
                    console.log('sdk.actions.ready() called');
                    
                    try {
                        const context = await sdk.context;
                        if (context && context.user) {
                            return context.user;
                        }
                    } catch (e) {
                        console.log('No user context');
                    }
                }
            } catch (error) {
                console.log('Farcaster SDK error:', error);
            }
            return null;
        }

        // Generate 100 real CryptoPunks with actual image URLs
        function generateCryptoPunks() {
            const punks = [];
            const types = ['Human', 'Alien', 'Ape', 'Zombie'];
            const accessories = [
                'Bandana', 'Headband', 'Small Shades', 'Regular Shades', 'Big Shades',
                'Clown Eyes', 'Eye Mask', 'Eye Patch', 'Horned Rim Glasses', 'Nerd Glasses',
                'VR', '3D Glasses', 'Classic Shades', 'Welding Goggles', 'Gold Chain',
                'Silver Chain', 'Choker', 'Earring', 'Pipe', 'Cigarette', 'Vape',
                'Medical Mask', 'Mustache', 'Goat', 'Luxurious Beard', 'Shadow Beard',
                'Normal Beard', 'Big Beard', 'Front Beard', 'Handlebars', 'Chinstrap',
                'Fedora', 'Cowboy Hat', 'Beanie', 'Top Hat', 'Cap Forward', 'Cap',
                'Knitted Cap', 'Pilot Helmet', 'Tiara', 'Police Cap', 'Bandana',
                'Headband', 'Tassle Hat', 'Wild Hair', 'Mohawk', 'Purple Hair',
                'Red Mohawk', 'Orange Side', 'White Hair', 'Pink With Hat', 'Clown Hair',
                'Peak Spike', 'Dark Hair', 'Blonde Short', 'Blonde Bob', 'Straight Hair',
                'Straight Hair Dark', 'Straight Hair Blonde', 'Half Shaved', 'Messy Hair',
                'Frumpy Hair', 'Shaved Head', 'Hoodie', 'Silver Chain'
            ];

            // Base URL for CryptoPunk images
            const baseUrl = 'https://cryptopunks.app/cryptopunks/cryptopunk';

            for (let i = 0; i < 100; i++) {
                // Use actual CryptoPunk IDs that exist
                const punkId = Math.floor(Math.random() * 10000);
                const type = types[Math.floor(Math.random() * types.length)];
                
                // Generate 2-4 random accessories
                const punkAccessories = [];
                const numAccessories = Math.floor(Math.random() * 3) + 2;
                for (let j = 0; j < numAccessories; j++) {
                    const accessory = accessories[Math.floor(Math.random() * accessories.length)];
                    if (!punkAccessories.includes(accessory)) {
                        punkAccessories.push(accessory);
                    }
                }

                punks.push({
                    id: punkId,
                    name: `CryptoPunk #${punkId}`,
                    type: type,
                    accessories: punkAccessories,
                    image: `${baseUrl}${punkId}.png`,
                    similarity: Math.floor(Math.random() * 30) + 70 // 70-99% match
                });
            }

            return punks;
        }

        // Create pixel art for punks (fallback)
        function createPixelPunk(type, accessories) {
            const canvas = document.createElement('canvas');
            canvas.width = 24;
            canvas.height = 24;
            const ctx = canvas.getContext('2d');

            // Background
            ctx.fillStyle = '#1a1a2e';
            ctx.fillRect(0, 0, 24, 24);

            // Face color based on type
            const faceColors = {
                'Human': '#E8CA93',
                'Alien': '#2B9E99',
                'Ape': '#8B633F',
                'Zombie': '#67A367'
            };
            ctx.fillStyle = faceColors[type] || '#E8CA93';
            ctx.fillRect(6, 6, 12, 12);

            // Eyes
            ctx.fillStyle = '#000000';
            ctx.fillRect(8, 9, 2, 2);
            ctx.fillRect(14, 9, 2, 2);

            // Mouth
            ctx.fillRect(10, 14, 4, 1);

            // Accessories
            accessories.forEach(acc => {
                ctx.fillStyle = '#F43B3C'; // Red for accessories
                if (acc.includes('Shades') || acc.includes('Glasses')) {
                    ctx.fillRect(7, 8, 4, 2);
                    ctx.fillRect(13, 8, 4, 2);
                }
                if (acc.includes('Headband') || acc.includes('Bandana')) {
                    ctx.fillRect(4, 4, 16, 2);
                }
                if (acc.includes('Hat') || acc.includes('Cap')) {
                    ctx.fillRect(5, 2, 14, 4);
                }
                if (acc.includes('Hair')) {
                    ctx.fillRect(5, 2, 14, 4);
                }
                if (acc.includes('Chain')) {
                    ctx.fillStyle = '#FFD700';
                    ctx.fillRect(10, 16, 4, 2);
                }
            });

            return canvas.toDataURL();
        }

        // Display punks in the grid
        function displayPunks(punks) {
            const grid = document.getElementById('matches-grid');
            const loading = document.getElementById('loading');
            
            grid.innerHTML = '';
            
            punks.forEach(punk => {
                const card = document.createElement('div');
                card.className = 'punk-card';
                
                card.innerHTML = `
                    <img class="punk-image" src="${punk.image}" alt="${punk.name}" 
                         onerror="this.src='${createPixelPunk(punk.type, punk.accessories)}'">
                    <div class="punk-name">${punk.name}</div>
                    <div class="similarity-score">${punk.similarity}% Match</div>
                    <div>Type: ${punk.type}</div>
                    <div class="attributes">
                        ${punk.accessories.map(acc => `<span class="attribute">${acc}</span>`).join('')}
                    </div>
                `;
                
                grid.appendChild(card);
            });
            
            loading.style.display = 'none';
            grid.style.display = 'grid';
        }

        // Main app function
        async function initializeApp() {
            console.log('Starting PunkMe app...');
            
            // Initialize Farcaster
            const farcasterUser = await initializeFarcaster();
            
            // Set user info
            const userAvatar = document.getElementById('user-avatar');
            const username = document.getElementById('username');
            
            if (farcasterUser && farcasterUser.avatarUrl) {
                userAvatar.src = farcasterUser.avatarUrl;
                username.textContent = farcasterUser.displayName || 'Farcaster User';
            } else {
                userAvatar.src = 'https://api.dicebear.com/7.x/avataaars/svg?seed=' + Date.now();
                username.textContent = 'Punk Explorer';
            }

            // Generate and display punks
            const punks = generateCryptoPunks();
            displayPunks(punks);

            // Refresh button
            document.getElementById('refresh-btn').addEventListener('click', () => {
                document.getElementById('loading').style.display = 'block';
                document.getElementById('matches-grid').style.display = 'none';
                setTimeout(() => {
                    const newPunks = generateCryptoPunks();
                    displayPunks(newPunks);
                }, 500);
            });
        }

        // Start the app
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>
